# NOTES:
# :Z is private Docker share (guarded by SELinux); these files are for that
# container only.
# :z is public Docker share (guarded by SELinux); these files are for several
# containers to share.
volumes:
  kimai_public:
  nfs-flamenco:
    driver_opts:
      type: nfs
      o: addr=127.0.0.1,nfsvers=3
      device: :/srv/flamenco
services:
  letsencrypt:
    image: linuxserver/swag
    container_name: letsencrypt
    cap_add:
      - NET_ADMIN
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=America/Indianapolis
      - URL=maxocull.com
      - SUBDOMAINS=bazarr,books,ci,cloud,dash,dns,flamenco,git,groups.xmpp,hashcat,kimai,librarian,lidarr,llm,map,mastodon,media,mesh,notes,ntfy,nvr,office,openvpn,pgadmin,project,prowlarr,radarr,registry,rss,search,share.xmpp,sonarr,torrent,whoami,wireguard,www,xmpp,znc
      - VALIDATION=http
      #- DNSPLUGIN=cloudflare #optional
      #- DUCKDNSTOKEN=<token> #optional
      - EMAIL=max.ocull@protonmail.com
      #- DHLEVEL=2048 # No longer used?
      - ONLY_SUBDOMAINS=false
      - EXTRA_DOMAINS=git.alanocull.com,maxocull.net,bazarr.maxocull.net,books.maxocull.net,ci.maxocull.net,cloud.maxocull.net,dash.maxocull.net,dns.maxocull.net,flamenco.maxocull.net,git.maxocull.net,groups.xmpp.maxocull.net,hashcat.maxocull.net,kimai.maxocull.net,librarian.maxocull.net,lidarr.maxocull.net,llm.maxocull.net,map.maxocull.net,mastodon.maxocull.net,media.maxocull.net,mesh.maxocull.net,notes.maxocull.net,ntfy.maxocull.net,nvr.maxocull.net,office.maxocull.net,openvpn.maxocull.net,pgadmin.maxocull.net,project.maxocull.net,prowlarr.maxocull.net,radarr.maxocull.net,registry.maxocull.net,rss.maxocull.net,search.maxocull.net,share.xmpp.maxocull.net,sonarr.maxocull.net,torrent.maxocull.net,whoami.maxocull.net,wireguard.maxocull.net,www.maxocull.net,xmpp.maxocull.net,znc.maxocull.net
      - STAGING=false # Enable when testing.
      - DOCKER_MODS=linuxserver/mods:swag-dashboard
    volumes:
      #- /opt/flotilla/data/letsencrypt/keys:/config/etc/letsencrypt:Z
      #- /opt/flotilla/data/letsencrypt/www:/config/www:Z
      - /opt/flotilla/config/letsencrypt:/config:z
      #- /opt/flotilla/data/all/logs/letsencrypt:/config/log:z
    #volumes_from:
    # used for FPM
    #- nextcloud
    ports:
      - 80:80
      - 81:81 # used for dashboard mod
      - 443:443
    labels:
      - com.centurylinklabs.watchtower.enable=true
    restart: unless-stopped
  weblog:
    image: node:24-slim
    container_name: weblog
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=America/Indianapolis
      - NODE_ENV=production
    user: node
    working_dir: /home/node/weblog
    command: npm run full_serve
    volumes:
      - /opt/flotilla/data/weblog:/home/node/weblog:z
    ports:
      - 127.0.0.1:4000:4000
    labels:
      - com.centurylinklabs.watchtower.enable=true
    restart: unless-stopped
  dockersocket:
    # Limits access to the docker socket which is dangerous to expose to
    # containers which see the internet; compromise of these external facing
    # containers could mean granting root access to the entire host (and all
    # other containers).
    image: tecnativa/docker-socket-proxy
    container_name: dockersocket
    privileged: true # Necessary for docker access.
    ports:
      - 127.0.0.1:2375:2375
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=America/Indianapolis
      - LOG_LEVEL=debug # info
      #- EVENTS=1
      #- PING=1
      #- VERSION=1
      - AUTH=0 # Security critical
      - SECRETS=0 # Security critical
      - POST=0 # Security critical
      #- BUILD=1
      #- COMMIT=1
      #- CONFIGS=1
      - CONTAINERS=1 # For Traefik
      #- DISTRIBUTION=1
      #- EXEC=1
      #- IMAGES=1
      #- INFO=1
      - NETWORKS=1 # For Traefik
      #- NODES=1
      #- PLUGINS=1
      - SERVICES=1 # For Traefik
      #- SESSION=1
      #- SWARM=1
      #- SYSTEM=1
      #- VOLUMES=1
      - TASKS=1 # For Traefik
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    labels:
      - traefik.enable=false
      - com.centurylinklabs.watchtower.enable=true
    restart: unless-stopped
  watchtower:
    # Not recommended by LinuxServer.io for general use. We will auto-upgrade sparingly.
    image: containrrr/watchtower
    container_name: watchtower
    command:
      - --label-enable # By default, containers DO NOT upgrade with this settings, must be explicitly enabled.
    env_file:
      - /opt/flotilla/secrets.env
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=America/Indianapolis
      - WATCHTOWER_CLEANUP=true
      #- WATCHTOWER_POLL_INTERVAL=30
      - WATCHTOWER_TIMEOUT=60 # How long to wait before forcibly stopping a container.
      #- WATCHTOWER_DEBUG=true
      - WATCHTOWER_SCHEDULE=0 0 4 * * * # Every night at 04:00.
      - WATCHTOWER_NOTIFICATIONS=email
      - WATCHTOWER_NOTIFICATION_EMAIL_FROM=maxocull.com@gmail.com
      - WATCHTOWER_NOTIFICATION_EMAIL_TO=max.ocull@protonmail.com
      - WATCHTOWER_NOTIFICATION_EMAIL_SERVER=smtp.gmail.com
      - WATCHTOWER_NOTIFICATION_EMAIL_SERVER_PORT=587
      - WATCHTOWER_NOTIFICATION_EMAIL_SERVER_USER=maxocull.com@gmail.com
      - WATCHTOWER_NOTIFICATION_EMAIL_DELAY=2
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      #- /opt/flotilla/config/watchtower/config.json:/config.json:z
    labels:
      - com.centurylinklabs.watchtower.enable=true
    restart: unless-stopped
  gluetun:
    image: qmcgaw/gluetun:v3
    container_name: gluetun
    cap_add:
      - NET_ADMIN
    devices:
      - /dev/net/tun:/dev/net/tun
    #networks:
    #gluenet:
    #ipv4_address: 172.18.0.100
    #dns: 172.18.0.100
    env_file:
      - /opt/flotilla/secrets.env
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=America/Indianapolis
      - VPN_SERVICE_PROVIDER=nordvpn
      - VPN_TYPE=openvpn
      - OPENVPN_PROTOCOL=udp
      #- SERVER_COUNTRIES=Switzerland,Spain,Poland,Panama,Romania,Malaysia
      - SERVER_COUNTRIES=Netherlands
      - SERVER_CATEGORIES=P2P
      - UPDATER_PERIOD=24h
      # DNS over TLS
      - DOT=off
      - DOT_PROVIDERS=quad9
      - DOT_CACHING=on
      - DOT_IPV6=off
      # Unblock DNS for local connections
      - DNS_UPDATE_PERIOD=24h
      - BLOCK_MALICIOUS=on
      - BLOCK_SURVEILLANCE=on
      - BLOCK_ADS=on
      - UNBLOCK=maxocull.com,alanocull.com
      # Fixed DNS server:
      - DNS_ADDRESS=9.9.9.9
      - DNS_KEEP_NAMESERVER=on
      - HEALTH_TARGET_ADDRESS=www.quad9.net:443
      # Super insecure, just disable HTTP proxy.
      - HTTPPROXY=off
      - SHADOWSOCKS=on
      - SHADOWSOCKS_CIPHER=aes-256-gcm
    volumes:
      - /opt/flotilla/config/gluetun/base:/gluetun:Z
      - /opt/flotilla/config/gluetun/include.conf:/etc/unbound/include.conf:Z:ro
    ports:
      - 8888:8888/tcp # HTTP proxy
      - 8388:8388/tcp # Shadowsocks (SOCKS5)
      - 8388:8388/udp # Shadowsocks (SOCKS5)
      # Forwarded ports
      - 127.0.0.1:8080:8080 # Forward the WebUI port for qbitorrent.
      - 6881:6881 # Forward the Bittorrent for qbitorrent.
      - 6881:6881/udp # Forward the Bittorrent port for qbitorrent.
      #- "127.0.0.1:8989:8989" # Sonarr
      #- "127.0.0.1:7878:7878" # Radarr
      #- "127.0.0.1:8686:8686" # Lidarr
      - 127.0.0.1:9696:9696 # Prowlarr
      - 127.0.0.1:5299:5299 # LazyLibrarian
    labels:
      - com.centurylinklabs.watchtower.enable=true
    restart: unless-stopped
  qbittorrent:
    image: linuxserver/qbittorrent:latest
    container_name: qbittorrent
    depends_on:
      - gluetun
    network_mode: service:gluetun
    environment:
      - PUID=1000
      - PGID=1000
      - UMASK=000
      - TZ=America/Indianapolis
      - WEBUI_PORT=8080
      - TORRENTING_PORT=6881
    volumes:
      - /opt/flotilla/config/qbittorrent:/config:z
      # This is where torrent files are stored.
      - /opt/flotilla/data/all/torrents:/torrents:z
      # This is where the data pointed to by the torrent file is downloaded to and stored.
      - /opt/flotilla/data/all/downloads:/downloads:z
    #ports:
    #- "127.0.0.1:8080:8080"
    #- "6881:6881"
    #- "6881:6881/udp"
    labels:
      - com.centurylinklabs.watchtower.enable=true
    restart: unless-stopped
  sonarr:
    image: linuxserver/sonarr
    container_name: sonarr
    depends_on:
      - qbittorrent
      - prowlarr
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=America/Indianapolis
      - UMASK=022
    volumes:
      - /opt/flotilla/config/sonarr:/config:z
      - /opt/flotilla/data/all/tvshows:/tv:z
      - /opt/flotilla/data/all/downloads:/data:z
    ports:
      - 127.0.0.1:8989:8989
    labels:
      - com.centurylinklabs.watchtower.enable=true
    restart: unless-stopped
  radarr:
    image: linuxserver/radarr
    container_name: radarr
    depends_on:
      - qbittorrent
      - prowlarr
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=America/Indianapolis
      - UMASK=022
    volumes:
      - /opt/flotilla/config/radarr:/config:z
      - /opt/flotilla/data/all/movies:/movies:z
      - /opt/flotilla/data/all/downloads:/data:z
    ports:
      - 127.0.0.1:7878:7878
    labels:
      - com.centurylinklabs.watchtower.enable=true
    restart: unless-stopped
  lidarr:
    image: linuxserver/lidarr
    container_name: lidarr
    depends_on:
      - qbittorrent
      - prowlarr
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=America/Indianapolis
      - UMASK=022
    volumes:
      - /opt/flotilla/config/lidarr:/config:z
      - /opt/flotilla/data/all/music:/music:z
      - /opt/flotilla/data/all/downloads:/data:z
    ports:
      - 127.0.0.1:8686:8686
    labels:
      - com.centurylinklabs.watchtower.enable=true
    restart: unless-stopped
  bazarr:
    image: linuxserver/bazarr
    container_name: bazarr
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=America/Indianapolis
      - UMASK=022
    volumes:
      - /opt/flotilla/config/bazarr:/config:z
      - /opt/flotilla/data/all/tvshows:/tv:z
      - /opt/flotilla/data/all/movies:/movies:z
    ports:
      - 127.0.0.1:6767:6767
    labels:
      - com.centurylinklabs.watchtower.enable=true
    restart: unless-stopped
  prowlarr:
    image: linuxserver/prowlarr:latest
    container_name: prowlarr
    depends_on:
      - gluetun
      - qbittorrent
    network_mode: service:gluetun
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=America/Indianapolis
      - UMASK=022
    volumes:
      - /opt/flotilla/config/prowlarr:/config:z
    #ports:
    #- "127.0.0.1:9696:9696"
    labels:
      - com.centurylinklabs.watchtower.enable=true
    restart: unless-stopped
  jellyfin:
    image: linuxserver/jellyfin
    container_name: jellyfin
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=America/Indianapolis
      - UMASK_SET=<022> #optional
    volumes:
      - /opt/flotilla/config/jellyfin:/config:z
      - /opt/flotilla/data/all/tvshows:/data/tvshows:z
      - /opt/flotilla/data/all/movies:/data/movies:z
      - /opt/flotilla/data/all/music:/data/music:z
      - /opt/flotilla/data/all/books:/data/books:z # Intended for audio books.
      - /opt/flotilla/data/all/photos:/data/photos:z
      - /opt/flotilla/data/jellyfin/transcode:/transcode:z #optional
    ports:
      - 127.0.0.1:8096:8096
      #- "8920:8920" #optional, https
    devices:
      - /dev/dri:/dev/dri #optional, for video HW acceleration
    labels:
      - com.centurylinklabs.watchtower.enable=true
    restart: unless-stopped
  postgres:
    image: postgres:16
    container_name: postgres
    env_file:
      - /opt/flotilla/secrets.env
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=America/Indianapolis
      # md5 was used by legacy postgres versions, so we are retaining it for now.
      - POSTGRES_HOST_AUTH_METHOD=md5
      #- POSTGRES_USER=harbor # Use the default "postgres" user.
      #
    user: "1000" # We need this in order to share certs and make it public.
    ports:
      - 5432:5432
    volumes:
      # Don't forget to update the command below!
      - /opt/flotilla/config/postgres/postgresql.conf:/etc/postgresql/postgresql.conf:z
      - /opt/flotilla/config/postgres/pg_hba.conf:/etc/postgresql/pg_hba.conf:z
      - /opt/flotilla/data/postgres.16:/var/lib/postgresql/data:z
      - /opt/flotilla/config/letsencrypt/etc:/certs:ro
    command: postgres -c config_file=/etc/postgresql/postgresql.conf
    labels:
      - com.centurylinklabs.watchtower.enable=true
    restart: unless-stopped
  pgadmin:
    # Permissions errors are likely caused by files not being owned by user ID 5050 (pgadmin).
    image: dpage/pgadmin4
    container_name: pgadmin
    env_file:
      - /opt/flotilla/secrets.env
    depends_on:
      - postgres
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=America/Indianapolis
      # The email below _is_ the username.
      - PGADMIN_DEFAULT_EMAIL=postgres@maxocull.com
    ports:
      - 127.0.0.1:5480:80
    volumes:
      #- /opt/flotilla/config/pgadmin:/pgadmin4:z
      - /opt/flotilla/data/pgadmin:/var/lib/pgadmin:z
    restart: unless-stopped
    labels:
      - com.centurylinklabs.watchtower.enable=true
      - traefik.enable=true
      - traefik.http.routers.pgadmin.rule=PathPrefix(`/pgadmin`)
      - traefik.http.routers.pgadmin.entryPoints=http
      - traefik.http.middlewares.strip-pgadmin.stripPrefix.prefixes=pgadmin
      - traefik.http.routers.pgadmin.middlewares=strip-pgadmin
  redis:
    # TODO: Resolve some kernel settings to clear up the logs.
    image: redis:6
    container_name: redis
    command: redis-server /usr/local/etc/redis/redis.conf
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=America/Indianapolis
    ports:
      - 127.0.0.1:6379:6379
    volumes:
      - /opt/flotilla/data/redis:/data:z # Remove this line if not persistent.
      - /opt/flotilla/config/redis:/usr/local/etc/redis:Z
    labels:
      - com.centurylinklabs.watchtower.enable=true
    restart: unless-stopped
  nextcloud:
    image: nextcloud:32-apache
    container_name: nextcloud
    depends_on:
      - redis
      - postgres
      - nextcloud-cron
    env_file:
      - /opt/flotilla/secrets.env
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=America/Indianapolis
      - POSTGRES_DB=nextcloud
      - POSTGRES_USER=nextcloud
      - POSTGRES_HOST=postgres
      - NEXTCLOUD_ADMIN_USER=entourage
      - REDIS_HOST=redis
      - SMTP_HOST=smtp.gmail.com
      - SMTP_SECURE=tls
      - SMTP_PORT=587
      - SMTP_NAME=maxocull.com
      - MAIL_FROM_ADDRESS=maxocull.com@gmail.com
      - PHP_MEMORY_LIMIT=2G
      - PHP_UPLOAD_LIMIT=2G
      #- MAIL_DOMAIN=mail.maxocull.com
    volumes:
      - /opt/flotilla/config/nextcloud:/var/www/html/config:z
      - /opt/flotilla/data/nextcloud:/var/www/html:z # Share this folder with cron.
    ports:
      - 127.0.0.1:3080:80
      #- "3090:9000" # for FPM
    labels:
      - com.centurylinklabs.watchtower.enable=true
    restart: unless-stopped
  nextcloud-cron:
    # https://github.com/nextcloud/docker/issues/134
    image: nextcloud:32-apache
    container_name: nextcloud-cron
    entrypoint: /cron.sh
    depends_on:
      - redis
      - postgres
    env_file:
      - /opt/flotilla/secrets.env
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=America/Indianapolis
      - POSTGRES_DB=nextcloud
      - POSTGRES_USER=nextcloud
      - POSTGRES_HOST=postgres
      - NEXTCLOUD_ADMIN_USER=entourage
      - REDIS_HOST=redis
      - SMTP_HOST=smtp.gmail.com
      - SMTP_SECURE=tls
      - SMTP_PORT=587
      - SMTP_NAME=maxocull.com
      - MAIL_FROM_ADDRESS=maxocull.com@gmail.com
      - PHP_MEMORY_LIMIT=2G
      - PHP_UPLOAD_LIMIT=2G
      #- MAIL_DOMAIN=mail.maxocull.com
    volumes:
      - /opt/flotilla/config/nextcloud:/var/www/html/config:z
      - /opt/flotilla/data/nextcloud:/var/www/html:z # Share this folder with cron.
    labels:
      - com.centurylinklabs.watchtower.enable=true
    restart: unless-stopped
  heimdall:
    image: linuxserver/heimdall
    container_name: heimdall
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=America/Indianapolis
    volumes:
      - /opt/flotilla/config/heimdall:/config:z
    ports:
      - 127.0.0.1:1080:80
      - 127.0.0.1:1443:443
    restart: unless-stopped
    labels:
      - com.centurylinklabs.watchtower.enable=true
  rssbridge:
    image: rssbridge/rss-bridge
    container_name: rssbridge
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=America/Indianapolis
    volumes:
      - /opt/flotilla/config/rssbridge/whitelist.txt:/app/whitelist.txt:z
      - /opt/flotilla/config/rssbridge/config.ini.php:/app/config.ini.php:z
    ports:
      - 127.0.0.1:5080:80
    labels:
      - com.centurylinklabs.watchtower.enable=true
    restart: unless-stopped
  znc:
    image: lscr.io/linuxserver/znc
    container_name: znc
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Europe/London
    volumes:
      - /opt/flotilla/config/znc:/config:z
      # https://wiki.znc.in/Signed_SSL_certificate#Certbot
      #- /opt/flotilla/config/letsencrypt/keys/letsencrypt/priv-fullchain-bundle.pem:/config/znc.pem:ro
      - /opt/flotilla/config/letsencrypt/etc/letsencrypt/live/maxocull.com/priv-fullchain-bundle.pem:/config/znc.pem:ro
    ports:
      - 6501:6501
      - 6502:6502
    labels:
      - com.centurylinklabs.watchtower.enable=true
    restart: unless-stopped
  nfs:
    image: ghcr.io/obeone/nfs-server
    container_name: nfs
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=America/Indianapolis
      #- NFS_VERSION=3
      #- NFS_DISABLE_VERSION_3=1
      - NFS_LOG_LEVEL=DEBUG
    cap_add:
      - SYS_ADMIN
      - SYS_MODULE
    volumes:
      - /opt/flotilla/data/nfs/flamenco:/srv/flamenco:z
      - /opt/flotilla/config/nfs/exports:/etc/exports:z
      - /lib/modules:/lib/modules:ro
    deploy:
      resources:
        limits:
          memory: 512M
    ports:
      # For NFSv4:
      - 2049:2049
      # For NFSv3:
      - 111:111
      - 32765:32765
      - 32767:32767
    restart: unless-stopped
  flamenco-manager:
    image: maxattax/flamenco-manager:latest
    container_name: flamenco-manager
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=America/Indianapolis
    ports:
      - 127.0.0.1:8082:80
    volumes:
      - /opt/flotilla/config/flamenco:/config:Z
      - /opt/flotilla/data/flamenco:/data:Z
      - /opt/flotilla/data/nfs/flamenco:/srv/flamenco:z
    restart: unless-stopped
  gitea-runner:
    image: gitea/act_runner:latest
    container_name: gitea-runner
    security_opt:
      - seccomp:unconfined
    cap_add:
      - NET_ADMIN
    devices:
      - /dev/net/tun
    env_file:
      - /opt/flotilla/secrets.env
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=America/Indianapolis
      - CONFIG_FILE=/config/config.yaml
      - GITEA_INSTANCE_URL=https://git.alanocull.com
      - GITEA_RUNNER_NAME=entourage-alfa
    volumes:
      - /opt/flotilla/config/gitea-runner:/config:z
      - /opt/flotilla/data/gitea-runner:/data:z
      # The docker socket allows it to spawn child containers.
      - /var/run/docker.sock:/var/run/docker.sock
    labels:
      - com.centurylinklabs.watchtower.enable=true
    restart: unless-stopped
  open-webui:
    image: ghcr.io/open-webui/open-webui:main
    container_name: open-webui
    env_file:
      - /opt/flotilla/secrets.env
    environment:
      # https://docs.openwebui.com/getting-started/env-configuration
      - PUID=1000
      - PGID=1000
      - TZ=America/Indianapolis
      # This points to Leviathan for servicing the ollama API.
      - OLLAMA_BASE_URL=http://192.168.1.11:11434
      - WEBUI_AUTH=True
      - WEBUI_URL=https://llm.maxocull.com
      # TODO: Disable signups
      - ENABLE_SIGNUP=True
      # TODO: Change this to Postgres later:
      #- DATABASE_URL=sqlite:///${DATA_DIR}/webui.db
      # TODO: TTS and STT
      # TODO: Image generation
      - ENABLE_ADMIN_CHAT_ACCESS=False
    volumes:
      - /opt/flotilla/data/open-webui:/app/backend/data:Z
    ports:
      - 127.0.0.1:3081:8080
    labels:
      - com.centurylinklabs.watchtower.enable=true
    restart: unless-stopped
  joplin:
    image: joplin/server:amd64-3
    container_name: joplin
    depends_on:
      - postgres
    env_file:
      - /opt/flotilla/secrets.env
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=America/Indianapolis
      - APP_PORT=22300
      - APP_BASE_URL=https://notes.maxocull.com
      - DB_CLIENT=pg
      - POSTGRES_USER=joplin
      - POSTGRES_DATABSE=joplin
      - POSTGRES_PORT=5432
      - POSTGRES_HOST=postgres
    ports:
      - 127.0.0.1:22300:22300
    labels:
      - com.centurylinklabs.watchtower.enable=true
    restart: unless-stopped
  minecraft:
    # docker exec minecraft rcon-cli stop
    # docker exec minecraft rcon-cli stop
    image: itzg/minecraft-server
    container_name: minecraft
    environment:
      - UID=1000
      - GID=1000
      - TZ=America/Indianapolis
      - VERSION=23w12a
      - EULA=TRUE
      #- CONSOLE=FALSE
      - GUI=FALSE
      - MEMORY=4G
      - JVM_XX_OPTS=-XX:+UseG1GC -XX:G1HeapRegionSize=32M -XX:+UnlockExperimentalVMOptions -XX:MaxGCPauseMillis=50 -XX:TargetSurvivorRatio=90 -XX:G1NewSizePercent=50 -XX:G1MaxNewSizePercent=80 -XX:+ParallelRefProcEnabled -XX:CodeCacheExpansionSize=1M -XX:InitialCodeCacheSize=32M -XX:ReservedCodeCacheSize=64M -XX:-TieredCompilation -XX:CompileThreshold=1000 -XX:CICompilerCount=16 -XX:CompilerThreadPriority=3 -XX:FreqInlineSize=325 -XX:InlineSmallCode=2000 -XX:MaxInlineSize=1024
      # These below are only used if server.properties doesn't already exist.
      - SERVER_NAME=maxocull.com
      - MOTD=Welcome to maxocull.com!
      - DIFFICULTY=hard
      - OPS=Maxattax,StagMath,houndeyex
      - ICON=https://www.gravatar.com/avatar/7143b51c5a72389622b31375e5e91b5b
      - MAX_PLAYERS=20
      - ALLOW_NETHER=true
      - ANNOUNCE_PLAYER_ACHIEVEMENTS=true
      - ENABLE_COMMAND_BLOCK=true
      - FORCE_GAMEMODE=false
      - GENERATE_STRUCTURES=true
      - HARDCORE=false
      - SPAWN_ANIMALS=true
      - SPAWN_MONSTERS=true
      - SPAWN_NPCS=true
      - SPAWN_PROTECTION=128
      - VIEW_DISTANCE=14
      - MODE=survival
      - PVP=true
      - LEVEL_TYPE=AMPLIFIED
      - LEVEL=world
      - ALLOW_FLIGHT=false
    volumes:
      - /opt/flotilla/data/minecraft:/data:Z
    ports:
      - 25565:25565
    labels:
      - com.centurylinklabs.watchtower.enable=true
    restart: unless-stopped
